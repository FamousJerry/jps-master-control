<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jingjai Productions Master Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #141414; font-family: 'Inter', sans-serif; color: #fff; }
        .logo-neon { color: #39FF14; text-shadow: 0 0 2px #39FF14, 0 0 8px #39FF14, 0 0 15px #1c7a0a; }
        .action-button { background-color: #2d9e1c; transition: background-color 0.3s; }
        .action-button:hover { background-color: #39FF14; color: #141414; }
        #mainNav a.active-nav { color: #39FF14; font-weight: 700; }
        .form-input { background-color: #333; border: 1px solid #555; border-radius: 4px; padding: 12px 16px; width: 100%; color: #fff; transition: border-color 0.3s; }
        .form-input:focus { outline: none; border-color: #39FF14; }
        .module-card { background-color: #2F2F2F; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .module-card:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .hidden-view { display: none; }
    </style>
</head>
<body>

    <!-- This container holds the entire application. We will show/hide views inside it. -->
    <div id="app-container">

        <!-- LOGIN VIEW -->
        <div id="login-view" class="flex items-center justify-center min-h-screen hidden-view">
            <div class="w-full max-w-md p-8 space-y-8 rounded-lg" style="background-color: rgba(0, 0, 0, 0.8);">
                <div class="text-center">
                    <h1 class="text-3xl font-bold logo-neon mb-2">Jingjai Productions</h1>
                    <h2 class="text-2xl font-semibold">Master Control Login</h2>
                </div>
                <form id="login-form" class="space-y-6">
                    <div id="login-error" class="text-red-500 text-sm text-center hidden"></div>
                    <div>
                        <input id="login-email" type="email" required class="form-input" placeholder="Email address">
                    </div>
                    <div>
                        <input id="login-password" type="password" required class="form-input" placeholder="Password">
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-3 px-4 rounded-md text-sm font-bold text-white action-button">
                            Sign in
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MAIN APPLICATION VIEW (Dashboard, Modules, etc.) -->
        <div id="main-app-view" class="hidden-view">
            <header class="fixed top-0 left-0 right-0 bg-black z-50 p-4 md:px-8 flex justify-between items-center">
                <div class="flex items-center space-x-4 md:space-x-8">
                    <h1 class="text-lg md:text-2xl font-bold logo-neon whitespace-nowrap">
                        <span class="hidden md:inline">Jingjai Productions Master Control</span>
                        <span class="md:hidden">JP Master Control</span>
                    </h1>
                    <nav id="mainNav" class="hidden md:flex space-x-4">
                        <a href="#" data-view="dashboard-view" class="nav-link text-white font-semibold hover:text-gray-300 active-nav">Dashboard</a>
                        <a href="#" data-view="crm-view" class="nav-link text-white font-semibold hover:text-gray-300">CRM</a>
                        <a href="#" data-view="inventory-view" class="nav-link text-white font-semibold hover:text-gray-300">Inventory</a>
                        <a href="#" data-view="admin-view" class="nav-link text-white font-semibold hover:text-gray-300">Admin</a>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p id="user-display-name" class="font-semibold"></p>
                        <p id="user-display-role" class="text-xs text-gray-400"></p>
                    </div>
                    <button id="logout-button" class="text-xs text-gray-400 hover:text-white">Logout</button>
                </div>
            </header>

            <main class="pt-24 px-4 md:px-8">
                <!-- This is where the different module views will be shown -->
                <div id="module-container">
                    
                    <!-- Dashboard View -->
                    <div id="dashboard-view" class="module-view">
                        <h2 class="text-3xl font-bold mb-6">Dashboard</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                           <div class="module-card p-4 rounded-lg cursor-pointer" data-view="crm-view">
                               <h3 class="font-bold text-lg">CRM</h3><p class="text-sm text-gray-400">Manage clients and leads.</p>
                           </div>
                           <div class="module-card p-4 rounded-lg cursor-pointer" data-view="inventory-view">
                               <h3 class="font-bold text-lg">Inventory</h3><p class="text-sm text-gray-400">Track equipment and stock.</p>
                           </div>
                           <div class="module-card p-4 rounded-lg cursor-pointer">
                               <h3 class="font-bold text-lg">Sales Quoting</h3><p class="text-sm text-gray-400">Create and send quotes.</p>
                           </div>
                           <div class="module-card p-4 rounded-lg cursor-pointer">
                               <h3 class="font-bold text-lg">Job Scheduling</h3><p class="text-sm text-gray-400">Coordinate your team.</p>
                           </div>
                        </div>
                    </div>

                    <!-- CRM View (Placeholder) -->
                    <div id="crm-view" class="module-view hidden-view">
                        <h2 class="text-3xl font-bold">CRM Module</h2>
                        <p class="text-gray-400 mt-4">This is where the Customer Relationship Management module will live.</p>
                    </div>

                    <!-- Inventory View (Placeholder) -->
                    <div id="inventory-view" class="module-view hidden-view">
                        <h2 class="text-3xl font-bold">Inventory Module</h2>
                        <p class="text-gray-400 mt-4">This is where the Inventory Control module will live.</p>
                    </div>

                    <!-- Admin / User Management View -->
                    <div id="admin-view" class="module-view hidden-view">
                        <h2 class="text-3xl font-bold mb-6">Admin: User Management</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Create New User</h3>
                                <form id="create-user-form" class="space-y-4">
                                    <div id="create-user-error" class="text-red-500 text-sm hidden"></div>
                                    <div id="create-user-success" class="text-green-500 text-sm hidden"></div>
                                    <input id="new-user-name" type="text" required class="form-input" placeholder="Full Name">
                                    <input id="new-user-email" type="email" required class="form-input" placeholder="Email Address">
                                    <input id="new-user-password" type="password" required class="form-input" placeholder="Password">
                                    <select id="new-user-role" class="form-input">
                                        <option value="Team Member">Team Member</option>
                                        <option value="Admin">Admin</option>
                                    </select>
                                    <button type="submit" class="action-button font-bold py-2 px-4 rounded-md">Create User</button>
                                </form>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Current Users</h3>
                                <div id="user-list" class="space-y-2">
                                    <!-- User list will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        // IMPORTANT: Replace this with your actual Firebase config object
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "jps-app-468911", // Your Project ID is correct here
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM ELEMENTS ---
        const loginView = document.getElementById('login-view');
        const mainAppView = document.getElementById('main-app-view');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');
        const userDisplayName = document.getElementById('user-display-name');
        const userDisplayRole = document.getElementById('user-display-role');
        const mainNav = document.getElementById('mainNav');
        const moduleContainer = document.getElementById('module-container');
        const createUserForm = document.getElementById('create-user-form');
        const createUserError = document.getElementById('create-user-error');
        const createUserSuccess = document.getElementById('create-user-success');
        const userList = document.getElementById('user-list');

        // --- AUTHENTICATION LOGIC ---
        
        // Listen for authentication state changes
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is logged in
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userDisplayName.textContent = userData.name;
                    userDisplayRole.textContent = userData.role;
                }
                loginView.classList.add('hidden-view');
                mainAppView.classList.remove('hidden-view');
                listenForUsers(); // Start listening for user list changes
            } else {
                // User is logged out
                loginView.classList.remove('hidden-view');
                mainAppView.classList.add('hidden-view');
            }
        });

        // Handle login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => {
                    loginError.textContent = "Error: " + error.message;
                    loginError.classList.remove('hidden');
                });
        });

        // Handle logout
        logoutButton.addEventListener('click', () => {
            signOut(auth);
        });

        // --- USER MANAGEMENT LOGIC ---

        // Handle create user form submission
        createUserForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('new-user-name').value;
            const email = document.getElementById('new-user-email').value;
            const password = document.getElementById('new-user-password').value;
            const role = document.getElementById('new-user-role').value;
            
            createUserError.classList.add('hidden');
            createUserSuccess.classList.add('hidden');

            try {
                // IMPORTANT: Firebase doesn't let you create users this way from the client-side
                // for security reasons. This is a placeholder. In a real app, this would be
                // handled by a secure backend function. For now, we'll just add to the database.
                // We will simulate the user creation by adding them to our 'users' collection.
                // You would need to create the actual user in the Firebase Console.
                
                // This is a simplified example. A real app would need a secure way to do this.
                // For now, we will just add the user profile to Firestore.
                // You will need to create the user in the Firebase Auth console manually.
                
                // We'll use a placeholder UID for this example.
                const placeholderUid = "user_" + Date.now();
                await setDoc(doc(db, "users", placeholderUid), { name, email, role });

                createUserSuccess.textContent = "User profile created in database. Please create their login in the Firebase Console.";
                createUserSuccess.classList.remove('hidden');
                createUserForm.reset();

            } catch (error) {
                createUserError.textContent = "Error: " + error.message;
                createUserError.classList.remove('hidden');
            }
        });

        // Listen for real-time updates to the user list
        function listenForUsers() {
            const usersCollection = collection(db, "users");
            onSnapshot(usersCollection, (snapshot) => {
                userList.innerHTML = ''; // Clear the list
                snapshot.forEach((doc) => {
                    const userData = doc.data();
                    const userElement = document.createElement('div');
                    userElement.className = 'bg-gray-700 p-2 rounded flex justify-between items-center';
                    userElement.innerHTML = `
                        <div>
                            <p class="font-semibold">${userData.name}</p>
                            <p class="text-xs text-gray-400">${userData.email} - ${userData.role}</p>
                        </div>
                    `;
                    userList.appendChild(userElement);
                });
            });
        }


        // --- NAVIGATION LOGIC ---
        mainNav.addEventListener('click', (e) => {
            if (e.target.classList.contains('nav-link')) {
                e.preventDefault();
                const viewId = e.target.dataset.view;
                
                // Hide all module views
                document.querySelectorAll('.module-view').forEach(view => view.classList.add('hidden-view'));
                
                // Show the selected module view
                document.getElementById(viewId).classList.remove('hidden-view');

                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active-nav'));
                e.target.classList.add('active-nav');
            }
        });
        
        // Handle clicking on dashboard cards to navigate
        document.querySelectorAll('.module-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const viewId = e.currentTarget.dataset.view;
                if(viewId) {
                    document.querySelector(`.nav-link[data-view="${viewId}"]`).click();
                }
            });
        });

    </script>
</body>
</html>
